<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="keywords" content="hexo,个人博客,blog">
  <meta name="description" content="MeiJuna的个人博客">
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">
  <link rel="dns-prefetch" href="https://at.alicdn.com">
  
  <link rel="dns-prefetch" href="https://widget.daovoice.io">
  <link rel="dns-prefetch" href="https://widget-static-cdn.daovoice.io">
  <link rel="dns-prefetch" href="https://im.daovoice.io">
  
  
  <link rel="dns-prefetch" href="https://hm.baidu.com/">
  
  
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://api.github.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  
  <link rel="stylesheet" type="text/css" href="/./style/main.css">
	<link rel="shortcut icon" href="/favicon.ico" title="Favicon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
	<title>Node 基础语法</title>
  
  <script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?awwssw1snsnsnn1ndndnndnd99j";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();
  </script>
  
  
    <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/123456.js","daovoice");daovoice('init',{app_id: "123456"});daovoice('update');
  </script>
  
</head>
<body>
  <canvas id="pattern-placeholder" height="230"></canvas>
<div class="navbar-header">
  <a class="blog-title" href="/">MeiJuna</a>
  <a class="face-img" href="/">
    <img src="https://avatars0.githubusercontent.com/u/28977046?s=400&amp;u=430ddb4a4bb56956162100daf3ef6f79a5b65bd2&amp;v=4">
  </a>
</div>
<main>
  <div class="article-title">
    
  
  <h1 class="title">
    Node 基础语法
  </h1>
  


    <ul class="article-info">
      <li>
        发布
        <time datetime="2019-06-18T11:17:05.191Z" itemprop="datePublished">2019-06-18</time>
      </li>
      <li>
        
    更新 <time datetime="2019-06-18T05:41:20.999Z" itemprop="dateUpdated">2019-06-18</time>

      </li>
      <li id="busuanzi_container_page_pv">
        阅读 <span id="busuanzi_value_page_pv"></span>
      </li>
    </ul>
  </div>
  <div class="container">
    <div class="article">
      <div class="content">
        
        <h1 id="Node-基础语法"><a href="#Node-基础语法" class="headerlink" title="Node 基础语法"></a>Node 基础语法</h1><ul>
<li><p>浏览器Javascript 不能做什么？</p>
<ol>
<li>访问数据库</li>
<li>不能对文件进行操作</li>
<li>不能对系统进行操作</li>
</ol>
<p>原因是为了安全，和浏览器的运行机制有关</p>
</li>
<li><p>在开发人员能力相同的情况下编程语言的能力取决于什么？</p>
<p>取决于平台，</p>
<ul>
<li>cordova hbuilder    平台  platform</li>
<li>java   java虚拟机        （运行平台）</li>
<li>php    php虚拟机</li>
<li>+c#     .net framework   mono</li>
<li>+js     解析内核  chrome v8 </li>
</ul>
</li>
</ul>
<h2 id="1-node-特点"><a href="#1-node-特点" class="headerlink" title="1.  node 特点"></a>1.  node 特点</h2><h3 id="什么是node"><a href="#什么是node" class="headerlink" title="什么是node ?"></a>什么是node ?</h3><ul>
<li><p>Node.js 是一个运行在Chrome V8 引擎的JavaScript 的一个运行环境 </p>
</li>
<li><p>Node.js使用了一个事件驱动、非阻塞式I/O的模型,使其轻量又高效</p>
<ul>
<li><p>事件驱动： 任务执行，发布者，订阅者，事件驱动 （  on  emit  ）</p>
</li>
<li><p>非阻塞： 执行某一个任务的同时也可以执行其他任务</p>
</li>
<li><p>阻塞： 执行某一个任务，这个任务如果没有执行完成，其他任务必须等待</p>
<ul>
<li>同步</li>
<li>异步</li>
</ul>
</li>
<li><p>I/O: 输入/输出（ 数据库，文件系统操作等操作  ）</p>
<ul>
<li>非阻塞I/O模型： 当我们使用Node.js来实现数据库操作、文件系统等操作时，要进行的异步操作，异步操作的核心传统实现方式就是回调函数</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-服务器："><a href="#2-服务器：" class="headerlink" title="2. 服务器："></a>2. 服务器：</h2><ul>
<li><p>定义： 可以运行在服务端的一个网站（站点）</p>
</li>
<li><p>种类：</p>
<ol>
<li><p>web服务器（ 静态服务器 ），可以运行在浏览器中的服务器</p>
</li>
<li><p>api 服务器（ 后端接口 )，后端语言暴露一个数据接口，用于前端的请求</p>
</li>
</ol>
</li>
</ul>
<h4 id="1-http-创建web服务器："><a href="#1-http-创建web服务器：" class="headerlink" title="1. http 创建web服务器："></a>1. http 创建web服务器：</h4><ul>
<li><p>http 模块</p>
<ul>
<li>createServer( callback(request, response, [next]){ })</li>
<li>listen(port, host, callback)  //监听服务器 （ 反馈服务器状态）</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="comment">// 1. 引入http模块(对象)</span></span><br><span class="line"> <span class="keyword">const</span> http = reqiure(<span class="string">'http'</span>);</span><br><span class="line"> <span class="comment">//2. 通过httpP模块上的 createServer 这个api 创建一个函数</span></span><br><span class="line"> <span class="comment">//3. 创建服务器端口和域名</span></span><br><span class="line"> <span class="keyword">const</span> port = <span class="number">8888</span>;</span><br><span class="line"> <span class="keyword">const</span> host = <span class="string">'localhost'</span>;<span class="comment">//127.0.0.1</span></span><br><span class="line"> <span class="keyword">const</span> server = http.createServer( <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">     response.writeHead(<span class="number">200</span>, &#123;   <span class="comment">//设置响应头</span></span><br><span class="line">         <span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTFf8'</span></span><br><span class="line"> 	&#125;)</span><br><span class="line"> 	response.write(<span class="string">'返回给客户端的数据'</span>);<span class="comment">//向前台发送信息</span></span><br><span class="line">     response.end(); <span class="comment">//发送已经结束</span></span><br><span class="line"> &#125;).listen( port, host, () =&gt; &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">`The server running at:http://<span class="subst">$&#123; host &#125;</span> : <span class="subst">$&#123; port &#125;</span> `</span>)</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line">ps:因为浏览器在请求时会默认发送favicon.ico图标请求,如需阻止在http回调函数里环境里判断阻止</span><br><span class="line">代码示例:</span><br><span class="line">    <span class="keyword">if</span>(request.url.indexOf(<span class="string">"favicon.ico"</span>) === <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">ps:关于设置响应头解析类型的设置</span><br><span class="line">    <span class="string">"Content-type"</span>:<span class="string">"text/html;charset=utf-8"</span>		解析HTML标签以及属性</span><br><span class="line">                    <span class="string">"text/plain"</span>					纯文本</span><br><span class="line">                    <span class="string">"text/css"</span>						解析css</span><br><span class="line">                    <span class="string">"text/javascript"</span>				解析js</span><br><span class="line">                    <span class="string">"text/png"</span>						解析图片</span><br><span class="line">                    <span class="string">"text/json"</span>						json数据</span><br><span class="line">                    <span class="string">"......"</span></span><br></pre></td></tr></table></figure>
<h4 id="2-express-来创建api服务器"><a href="#2-express-来创建api服务器" class="headerlink" title="2. express 来创建api服务器"></a>2. express 来创建api服务器</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.get(路由路径，(路由回调函数(路由中间件),next) =&gt; &#123; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express() <span class="comment">//创建了一个app对象</span></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res, next)  =&gt; &#123;&#125;)</span><br><span class="line">app.listen(port, hostname, () =&gt; &#123;  <span class="comment">//创建一个服务器</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`The server is runinng at:http://<span class="subst">$&#123; hostname&#125;</span>:<span class="subst">$&#123; port &#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="3-Node-中文乱码问题解决："><a href="#3-Node-中文乱码问题解决：" class="headerlink" title="3. Node 中文乱码问题解决："></a>3. Node 中文乱码问题解决：</h2><h4 id="1-设置请求头"><a href="#1-设置请求头" class="headerlink" title="1. 设置请求头"></a>1. 设置请求头</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line"> 	<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF8'</span></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-发送-response-write"><a href="#2-发送-response-write" class="headerlink" title="2. 发送 response.write()"></a>2. 发送 response.write()</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.write(<span class="string">'&lt;meta charset=UTF-8&gt;'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="3-toString"><a href="#3-toString" class="headerlink" title="3. toString()"></a>3. toString()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对二进制有效：将二进制 -》 toSrgin()</span><br></pre></td></tr></table></figure>
<h2 id="4-Node-实时监听-自动刷新"><a href="#4-Node-实时监听-自动刷新" class="headerlink" title="4. Node 实时监听(自动刷新)"></a>4. Node 实时监听(自动刷新)</h2><p>借助第三方工具：</p>
<ul>
<li>nodemon [ 推荐 ]</li>
<li>supervisor</li>
</ul>
<h2 id="5-commonJS规范"><a href="#5-commonJS规范" class="headerlink" title="5. commonJS规范"></a>5. commonJS规范</h2><ul>
<li>CommonJs 规范的提出，主要是为了弥补 javascript 没有标准的缺陷，希望javascript 能在任何地方运行，能向java和Python具有开发大型应用的基础能力，可不是停留在脚本程序的阶段。</li>
<li>commonJS规范思想 是单独的文件就是一个模块,每一个模块都是一个独立的作用域</li>
<li>每个文件对外接口都是module.exports对象</li>
</ul>
<h3 id="1-CommonJs的模块规范"><a href="#1-CommonJs的模块规范" class="headerlink" title="1. CommonJs的模块规范"></a>1. CommonJs的模块规范</h3><p>CommonJS对模块的定义主要分为：</p>
<h4 id="1-模块定义"><a href="#1-模块定义" class="headerlink" title="1. 模块定义"></a>1. 模块定义</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 模块定义</span></span><br><span class="line"><span class="keyword">const</span> student = &#123;   <span class="comment">//可以是对象(可以传多个)、函数、字符串</span></span><br><span class="line">    name: <span class="string">'meijuna'</span>,</span><br><span class="line">    jineng () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'I cn fly'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-模块导出"><a href="#2-模块导出" class="headerlink" title="2. 模块导出"></a>2. 模块导出</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2. 模块导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = student; <span class="comment">//安全性不高，只能到处多个</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;  <span class="comment">//更安全，批量导出</span></span><br><span class="line">	student,</span><br><span class="line">	fn</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="3-模块引用"><a href="#3-模块引用" class="headerlink" title="3. 模块引用"></a>3. 模块引用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3. 模块引用</span></span><br><span class="line"><span class="keyword">const</span> student = <span class="built_in">require</span>(<span class="string">'./xx.js'</span>); <span class="comment">// or</span></span><br><span class="line"><span class="keyword">const</span> &#123; student, fn &#125; = requie(<span class="string">'./xx.js); //可以按需引用</span></span><br></pre></td></tr></table></figure>
<h3 id="2-模块标识符主要分类："><a href="#2-模块标识符主要分类：" class="headerlink" title="2. 模块标识符主要分类："></a>2. 模块标识符主要分类：</h3><h4 id="1-内置模块-（http、fs"><a href="#1-内置模块-（http、fs" class="headerlink" title="1. 内置模块 （http、fs)"></a>1. 内置模块 （http、fs)</h4><h6 id="1）url-模块：处理-url"><a href="#1）url-模块：处理-url" class="headerlink" title="1）url 模块：处理 url"></a>1）url 模块：处理 url</h6><p>URL模块提供了三种处理path的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) 将path字符类型转成对象</span><br><span class="line">left url = <span class="string">"http://user:pass@host.com:8080/p/a/t/h?query=string#hash"</span>;</span><br><span class="line">url.parse(url,[可选布尔值],[可选项布尔值]);</span><br><span class="line">    &#123;			</span><br><span class="line">        单词解释			解析属性						属性解释</span><br><span class="line">        协议			protocol:<span class="string">"http:"</span>,					协议</span><br><span class="line">        斜线			slashes:<span class="literal">true</span>,						是否有<span class="comment">//</span></span><br><span class="line">        认证			auth:<span class="string">"user:pass"</span>,					用户名与密码</span><br><span class="line">        主机			host:<span class="string">"host.com:8080"</span>,				主机</span><br><span class="line">        接口			port:<span class="string">"8080"</span>,						端口</span><br><span class="line">        主机名			hostname:<span class="string">"host.com"</span>,				域名</span><br><span class="line">        搞砸			hash:<span class="string">"#hash"</span>, 						片段标识符,指向html页面某个dom元素的id</span><br><span class="line">        搜索			search:<span class="string">"?query=string"</span>,				? + 查询字符串</span><br><span class="line">        查询			query:<span class="string">"query=string"</span>,				查询字符</span><br><span class="line">        路径名			pathname:<span class="string">"/p/a/t/h"</span>,				端口号和?之间的 路径那部分</span><br><span class="line">        路径			path:<span class="string">"/p/a/t/h?query=string"</span>,		pathname + search </span><br><span class="line">        水平基准		href:全路径url						 原始路径</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="number">2</span>) 将对象转成url字符串</span><br><span class="line">		url.format(obj)</span><br><span class="line">		ps:参考结合parse方法;</span><br><span class="line"></span><br><span class="line">	<span class="number">3</span>) 替换或者替换(未验证)</span><br><span class="line">		url.resolve(<span class="keyword">from</span>,to)</span><br><span class="line">			<span class="keyword">from</span> 	源地址</span><br><span class="line">			to		需要添加或替换的标签</span><br><span class="line">			ps:form源地址末尾有/就是添加  没有就是替换 具体待验证</span><br></pre></td></tr></table></figure>
<h6 id="2-fs-模块"><a href="#2-fs-模块" class="headerlink" title="2) fs 模块"></a>2) fs 模块</h6><p>fs 模块是专门处理操作磁盘文件,特点每个方法都有同步和异步两种 (需注意:同步以sync结尾)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">读取文件:</span><br><span class="line">		fs.readFile(<span class="string">"文件路径"</span>,&#123;opt&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">			&#123;opt&#125;:可选项</span><br><span class="line">				encoding:<span class="string">"utf-8"</span>		以utf<span class="number">-8</span>国际编码读取文件内容</span><br><span class="line">				flag:<span class="string">"r+"</span>				read的简称,只读取文件,不存在即报错</span><br><span class="line">				flag:<span class="string">"w+"</span>				write的简称,读写文件,不存在则自动创建</span><br><span class="line"></span><br><span class="line">			err:errorObject				报错机制 一般用<span class="keyword">if</span>判断用<span class="keyword">throw</span>抛出错误</span><br><span class="line">				列:</span><br><span class="line">					<span class="keyword">if</span>(err)&#123;</span><br><span class="line">						<span class="keyword">throw</span> err</span><br><span class="line">					&#125;</span><br><span class="line">					ps:<span class="built_in">console</span>.error()	抛出错误,不影响程序执行</span><br><span class="line">			</span><br><span class="line">			data:成功读取的数据,是以buffer数据二进制存储格式存在</span><br><span class="line">			ps:data.toString()可以转成UTF<span class="number">-8</span>格式,等价于可选项中的encoding:<span class="string">"utf-8"</span>;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">	写入文件:</span><br><span class="line">		fs.writeFile(<span class="string">"写入路径"</span>,<span class="string">"内容数据"</span>,&#123;opt&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;&#125;);</span><br><span class="line">	</span><br><span class="line">	追加内容:</span><br><span class="line">		fs.appendFile(<span class="string">"追加文件路径"</span>,<span class="string">"内容数据"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br><span class="line">	</span><br><span class="line">	读取文件夹:</span><br><span class="line">		fs.readdir(<span class="string">"文件夹路径"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,paths</span>)</span>&#123;</span><br><span class="line">			ps:readdir是directory的缩写</span><br><span class="line">			paths:成功读取文件夹 用数组存储文件内容</span><br><span class="line">				</span><br><span class="line">		&#125;)</span><br><span class="line">	</span><br><span class="line">	创建文件夹:</span><br><span class="line">		fs.mkdir(<span class="string">"文件夹路径,同时也是文件夹名称"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="3）path-模块"><a href="#3）path-模块" class="headerlink" title="3）path 模块"></a>3）path 模块</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">拼接路径:</span><br><span class="line">		join(xx,xx,xxx,.）使用平台特定的分隔符,将所有给定的段连接在一起</span><br><span class="line">		ps:常用到的路径</span><br><span class="line">			__dirname	当前执行文件所在的绝对路径</span><br></pre></td></tr></table></figure>
<h6 id="4）querystring-模块"><a href="#4）querystring-模块" class="headerlink" title="4）querystring 模块"></a>4）querystring 模块</h6><p>querystring模块一般是对 http 请求的 URL 所带的数据进行解析处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) 格式数据格式化为字符串:stringify </span><br><span class="line">    <span class="keyword">let</span> objData = &#123;</span><br><span class="line">        name:<span class="string">"skye"</span>,</span><br><span class="line">        url:<span class="string">"http://skyelovedj.com"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> querystring = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line">    querystring.stringify(objData,<span class="string">"分隔符"</span>,<span class="string">"分配符"</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>) 将参数字符格式为对象:</span><br><span class="line">    <span class="keyword">let</span> strData = <span class="string">"name:skye&amp;age=18"</span></span><br><span class="line">    <span class="keyword">let</span> querystring = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line">    querystring.parse(strData,<span class="string">"分隔符"</span>,<span class="string">"分配符"</span>)</span><br><span class="line">    ps:分隔符和分配符是可选项</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>) 编码:</span><br><span class="line">    querystring.escape(<span class="string">"data"</span>)			只对符号与中文编码		</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>) 解码:</span><br><span class="line">    querystring.Unescape(<span class="string">"data"</span>)		只对符号与中文解码</span><br></pre></td></tr></table></figure>
<h6 id="5-zlib"><a href="#5-zlib" class="headerlink" title="5) zlib"></a>5) zlib</h6><p>制作压缩包的模块</p>
<p>流</p>
<p> *     可读的流： 可以通过文件系统读取的流 （ 数据流 ）</p>
<p> *     可写的流： 可以通过文件系统写入的流</p>
<p> *   管道流 ： 连通两个文件的通道 pipe</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>( <span class="string">'fs'</span> );</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>( <span class="string">'zlib'</span>); <span class="comment">//制作压缩包的模块</span></span><br><span class="line"><span class="comment">//创建可读的流</span></span><br><span class="line"><span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">'./a.txt'</span> );</span><br><span class="line"><span class="comment">//创建空压缩包</span></span><br><span class="line"><span class="keyword">const</span> gzib = zlib.createGzip();</span><br><span class="line"><span class="comment">//创建可写的流</span></span><br><span class="line"><span class="keyword">const</span> writeStream  = fs.createWriteStream(<span class="string">'./b.text.gz'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建流程</span></span><br><span class="line">readStream</span><br><span class="line">  .pipe( gzib )</span><br><span class="line">  .pipe( writeStream );</span><br></pre></td></tr></table></figure>
<h4 id="2-第三方模块"><a href="#2-第三方模块" class="headerlink" title="2. 第三方模块"></a>2. 第三方模块</h4><h4 id="3-自定义模块"><a href="#3-自定义模块" class="headerlink" title="3. 自定义模块"></a>3. 自定义模块</h4><h2 id="6-发送数据请求："><a href="#6-发送数据请求：" class="headerlink" title="6. 发送数据请求："></a>6. 发送数据请求：</h2><ol>
<li>http.request</li>
<li>request(封装 http-request 的第三方包)</li>
<li>http.get(options, (res) =&gt;{ })</li>
</ol>
<h2 id="7-前端模块化"><a href="#7-前端模块化" class="headerlink" title="7.   前端模块化"></a>7.   前端模块化</h2><p>为什么前端要使用模块化：</p>
<p>模块化：具有特定功能的一个对象(广义理解)</p>
<p>模块定义的流程：</p>
<pre><code>1. 定义模块
2.  导出模块
3.  应用模块
</code></pre><p>好处： </p>
<pre><code>1. 可以存储多个独立的功能块
2.  复用性高
</code></pre><p>种类：</p>
<pre><code>1.  ADM （ require.js )
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">define(&#123;</span><br><span class="line">     a:<span class="number">1</span>,</span><br><span class="line">     b:<span class="number">2</span></span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="built_in">require</span>([./a.js], <span class="function"><span class="keyword">function</span>(<span class="params"> moduleA </span>) </span>&#123;</span><br><span class="line"> 	<span class="comment">//moduleA指的是</span></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>CMD ( sea.js )</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module </span>)</span>&#123;</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="built_in">require</span>(<span class="string">'./b.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> moduleB </span>)</span>&#123;</span><br><span class="line">     <span class="comment">//moduleB就是b模块中导出的内容</span></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Common.js （ require.js ）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Node 使用了 Common.js 的规范</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*目录结构： name.js index.js */</span></span><br><span class="line"><span class="comment">//模块定义 name.js</span></span><br><span class="line"><span class="keyword">const</span> nameObj = &#123;</span><br><span class="line">    name: <span class="string">'MeiJuna'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//模块导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = nameObj;</span><br><span class="line"><span class="comment">//模块引用</span></span><br><span class="line"><span class="keyword">const</span> nameObj = <span class="built_in">require</span>(<span class="string">'./nameObj)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Node中Common.规范使用的三种类型：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> 	1. 内置模块 (指的是挂载在Node全局对象身上的 api )</span></span><br><span class="line"><span class="string"> 	2. 自定义模块</span></span><br><span class="line"><span class="string"> 	3. 第三方模块</span></span><br></pre></td></tr></table></figure>
<h2 id="7-跨域问题"><a href="#7-跨域问题" class="headerlink" title="7. 跨域问题"></a>7. 跨域问题</h2><h4 id="前端跨域"><a href="#前端跨域" class="headerlink" title="前端跨域"></a>前端跨域</h4><h5 id="1-jsonp"><a href="#1-jsonp" class="headerlink" title="1. jsonp"></a>1. jsonp</h5><h5 id="2-反向代理"><a href="#2-反向代理" class="headerlink" title="2. 反向代理"></a>2. 反向代理</h5><p>（前端创建一个虚拟后端服务器，后台服务器帮助我们跨域）</p>
<h4 id="后端跨域"><a href="#后端跨域" class="headerlink" title="后端跨域"></a>后端跨域</h4><h5 id="1-设置响应头"><a href="#1-设置响应头" class="headerlink" title="1. 设置响应头"></a>1. 设置响应头</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.setHeader(&apos;Access-Control-Allow-Origin&apos;, req.headers.origin);</span><br><span class="line">// req.headers.origin = http://127.0.0.1:5500/</span><br></pre></td></tr></table></figure>
<h5 id="2-使用第三方中间件-cors"><a href="#2-使用第三方中间件-cors" class="headerlink" title="2. 使用第三方中间件 (cors)"></a>2. 使用第三方中间件 (cors)</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.use( cors(&#123;</span><br><span class="line"> <span class="string">"origin"</span>: <span class="string">"*"</span>,</span><br><span class="line"> <span class="string">"methods"</span>: <span class="string">"GET,HEAD,PUT,PATCH,POST,DELETE"</span>,</span><br><span class="line"> <span class="string">"preflightContinue"</span>: <span class="literal">false</span>,</span><br><span class="line"> <span class="string">"optionsSuccessStatus"</span>: <span class="number">200</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<ul>
<li>中间件: 就是具有一定功能的函数</li>
</ul>
<h2 id="8-前端的异步流程"><a href="#8-前端的异步流程" class="headerlink" title="8. 前端的异步流程"></a>8. 前端的异步流程</h2><p>异步流程的任务是放在异步队列中的，</p>
<ol>
<li><p>传统的原始异步</p>
<ul>
<li>异步函数</li>
<li>事件</li>
</ul>
</li>
<li><p>使用异步流程工具 （ 别人封装好的东西 )</p>
<p>es6 Promise 对象  </p>
<p>all :依次执行完再执行</p>
<p>race: 谁快谁执行</p>
<p>es6 generator 函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">在function 关键字后加一个 * </span><br><span class="line"> * 通过 yield关键字定义任务</span><br><span class="line"> * fn().next() 来执行任务</span><br><span class="line"> 结果返回一个对象 &#123;value: &apos;任务结果&apos;, done: false &#125;</span><br><span class="line">   value表示 yield关键字有任务执行的结果</span><br><span class="line">   done 表示当前定义的所有的任务十分执行完整的一种状态</span><br><span class="line"> * 理解：</span><br><span class="line">   -多任务的定义，多任务执行</span><br><span class="line">   -让自己定义的多个任务一次执行，上一个任务如果没有完成，下一个任务就不会开始</span><br><span class="line"></span><br><span class="line"> function* fn() &#123;</span><br><span class="line">   yield &apos;任务1&apos;</span><br><span class="line">   yield &apos;任务2&apos;</span><br><span class="line">   return &apos;任务&apos;</span><br><span class="line"> &#125;</span><br><span class="line"> console.log( a.next())</span><br><span class="line"> console.log( a.next());</span><br></pre></td></tr></table></figure>
<p>es6(7) async 函数  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">es6,7</span><br><span class="line"> * 配合关键字 await表示等待，await 任务1 执行结束才会 执行任务2</span><br><span class="line"> * 使用场景： 数据先请求，然后把结果赋值到变量</span><br><span class="line"> async function fn() &#123;</span><br><span class="line"> 	const result = await &apos;任务1&apos;;</span><br><span class="line"> 	console.log( &apos;任务二&apos; );</span><br><span class="line">&#125;</span><br><span class="line">2. 箭头函数的写法</span><br><span class="line">const fn1 = async () =&gt; &#123;</span><br><span class="line">	const res = await &apos;任务3&apos;;</span><br><span class="line">	console.log( res );</span><br><span class="line">	cosnole.log( &apos;任务4&apos; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>   node中的 nextTick() 和 setImmediate()</p>
</li>
</ol>
<p>​<br>​        nextTIck<br>​        <em> setImmediate<br>​        </em><br>​        <em> 轮询： 一个事件往复执行，那么每一次执行完成，我们就认为是个轮询<br>​        </em> 事件轮询前， 使用nextTick<br>​        <em> 事件轮询后， 使用setImmediate<br>​        </em><br>​        * nextTick &gt; () =&gt;  &gt; setImmediate </p>
<p>​     </p>
<p> 第三方的 async.js 库</p>
<p>文档： <a href="http://caolan.github.io/async/v3/index.html" target="_blank" rel="noopener">async</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   cnpm i  yarn -g</span><br><span class="line">   yarn add <span class="keyword">async</span> -D</span><br><span class="line"></span><br><span class="line">- parallel: 并行</span><br><span class="line">- series ：串行,<span class="keyword">return</span> 数组，任务都是完整正确的，如果一个任务失败，后面的任务也会失败</span><br><span class="line"></span><br><span class="line">   主线程</span><br><span class="line">   并行 parallel &#123; <span class="attr">two</span>: <span class="number">2</span>, <span class="attr">one</span>: <span class="number">1</span> &#125;</span><br><span class="line">   串行 series &#123; <span class="attr">one</span>: <span class="number">1</span>, <span class="attr">two</span>: <span class="number">2</span> &#125;</span><br><span class="line">   结论： 主线程先执行，然后 parallel (谁快谁先走),最后 series 并行 (上个运行完，在运行下一个)</span><br></pre></td></tr></table></figure>
<h2 id="9-socket-通信"><a href="#9-socket-通信" class="headerlink" title="9.  socket 通信"></a>9.  socket 通信</h2><h4 id="1-基于后端的通信-pc"><a href="#1-基于后端的通信-pc" class="headerlink" title="1. 基于后端的通信  ( pc )"></a>1. 基于后端的通信  ( pc )</h4><ul>
<li>node 中的 net 模块</li>
</ul>
<p>服务器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>( <span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">"localhost"</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clients = &#123;&#125;; <span class="comment">//存储每一个客户端</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;      <span class="comment">//给客户端编号</span></span><br><span class="line"><span class="comment">//1. 创建服务器</span></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> net.createServer()</span><br><span class="line"><span class="comment">//2. 连接客户端</span></span><br><span class="line">server.on( <span class="string">'connection'</span>, client =&gt; &#123;</span><br><span class="line">  client.name = ++count; <span class="comment">///每个客户端起个名字</span></span><br><span class="line">  clients[ client.name ] = client; <span class="comment">//将每一个客户端 都存储在 clients 中，key:client.name</span></span><br><span class="line">  <span class="comment">//3. 获取客户端发来的数据</span></span><br><span class="line">  client.on( <span class="string">'data'</span>, msg =&gt; &#123;</span><br><span class="line">    boardcast( client, msg.toString() );</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">`用户 <span class="subst">$&#123; client.name &#125;</span> 说: <span class="subst">$&#123; msg.toString()&#125;</span>`</span> )</span><br><span class="line"> </span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//监听客户端的异常</span></span><br><span class="line">  client.on( <span class="string">'error'</span>, error =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`error is <span class="subst">$&#123; error &#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//监听客户端的下线行为</span></span><br><span class="line">  client.on( <span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">//将下线的客户端清除 --清除 clents 对象</span></span><br><span class="line">    <span class="keyword">delete</span> clients[ client.name ]</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`客户端<span class="subst">$&#123; client.name &#125;</span> closed~~`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//4. 将客户端发来的信息展示到自己终端上( 广播 )  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">boardcast</span>(<span class="params"> client, msg</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// 客户端  客户端发来的消息</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> clients) &#123;</span><br><span class="line">    clients[ key ].write( msg );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//5. 监听服务器</span></span><br><span class="line">server.listen( port, hostname, () =&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`The srerver is ruuing at:http://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  客户端：</span></span><br><span class="line"><span class="comment">    1. 创建socket</span></span><br><span class="line"><span class="comment">    2. socket连接服务器</span></span><br><span class="line"><span class="comment">    3. 给服务器发送信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建socket</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> net = <span class="built_in">require</span>( <span class="string">'net'</span> );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> socket = <span class="keyword">new</span> net.Socket();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> port = <span class="number">9000</span>;</span><br><span class="line">  <span class="keyword">const</span> hostname = <span class="string">'localhost'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> readline = <span class="built_in">require</span>( <span class="string">'readline'</span> );<span class="comment">//这是用来做命令行读取</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> rl = readline.createInterface(&#123;</span><br><span class="line">    input: process.stdin,</span><br><span class="line">    output: process.stdout</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 2. socket连接服务器</span></span><br><span class="line"></span><br><span class="line">  socket.connect( port,hostname, () =&gt; &#123;</span><br><span class="line">    <span class="comment">//当我第一次连接好服务器之后，我给服务器发送一个我连接好的信息</span></span><br><span class="line">    socket.write( <span class="string">'欢迎xxx来到xxx的直播间'</span> )</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//客户端监听自己的异常</span></span><br><span class="line"></span><br><span class="line">  socket.on( <span class="string">'error'</span>, error =&gt;  &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">`socket error is <span class="subst">$&#123; error &#125;</span>`</span> )</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  socket.on( <span class="string">'close'</span> , () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">`socket connection closed ~~~`</span> )</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 给服务器发送信息</span></span><br><span class="line"></span><br><span class="line">  socket.on( <span class="string">'data'</span>, msg =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( msg.toString() )<span class="comment">//客户端自己显示写的内容</span></span><br><span class="line">    say()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">say</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    rl.question(<span class="string">'请输入: '</span>, ( answer ) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>( answer === <span class="string">'bye'</span> )&#123;</span><br><span class="line">        <span class="comment">//要进行命令行的结束</span></span><br><span class="line">        socket.destroy() <span class="comment">//清除连接</span></span><br><span class="line">        rl.close()<span class="comment">// 关闭命令行读取</span></span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        socket.write( answer )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-基于H5的-webSocket-来完成-应用于移动端"><a href="#2-基于H5的-webSocket-来完成-应用于移动端" class="headerlink" title="2. 基于H5的 webSocket 来完成  ( 应用于移动端 )"></a>2. 基于H5的 webSocket 来完成  ( 应用于移动端 )</h4><p>服务器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  主服务器</span></span><br><span class="line"><span class="comment">    1. 通过ws模块来创建服务器</span></span><br><span class="line"><span class="comment">    2. 服务器连接客户端</span></span><br><span class="line"><span class="comment">      - 给客户端编号</span></span><br><span class="line"><span class="comment">    3. 接收客户端发来的信息</span></span><br><span class="line"><span class="comment">    4. 监听客户端下线</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 通过 ws模块 来创建服务器</span></span><br><span class="line">  <span class="keyword">const</span> webSocket = <span class="built_in">require</span>( <span class="string">'ws'</span> );</span><br><span class="line">  <span class="keyword">const</span> ws = <span class="keyword">new</span> webSocket.Server(&#123;</span><br><span class="line">    port: <span class="number">8000</span>,</span><br><span class="line">    host: <span class="string">'10.31.161.48'</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 服务器连接客户端</span></span><br><span class="line">  <span class="keyword">const</span> clients = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  ws.on( <span class="string">'connection'</span>, client =&gt; &#123;</span><br><span class="line">    <span class="comment">//   - 给客户端编号</span></span><br><span class="line">    client.name = ++count;</span><br><span class="line">    clients[ client.name ] = client </span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收客户端发来的数据</span></span><br><span class="line"></span><br><span class="line">    client.on( <span class="string">'message'</span>, msg =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log( <span class="string">`客户端 <span class="subst">$&#123; client.name &#125;</span>说：<span class="subst">$&#123; msg &#125;</span>`</span>)</span><br><span class="line">      boardcast( client,msg )</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 监听客户端下线</span></span><br><span class="line">    client.on( <span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">delete</span> clients[ client.name ]</span><br><span class="line">      <span class="built_in">console</span>.log( <span class="string">`客户端 <span class="subst">$&#123; client.name &#125;</span> closed~~`</span> )</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">boardcast</span> (<span class="params"> client,msg </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">var</span> key <span class="keyword">in</span> clients )&#123;</span><br><span class="line">      clients[ key ].send( msg )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  客户端连接服务器文件</span></span><br><span class="line"><span class="comment">    \(^o^)/~          h5 提供了一个 Socket  的全局对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket( <span class="string">'ws://10.31.161.48:8000'</span> )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ws.onopen = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ws.send( <span class="string">'欢迎来到xxx的直播间'</span> )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ws.onmessage = <span class="function">(<span class="params"> msg </span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> content = <span class="built_in">document</span>.querySelector( <span class="string">'#content'</span> );</span><br><span class="line">    content.innerHTML += msg.data + <span class="string">'&lt;br/&gt;'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ws.onerror = <span class="function">(<span class="params"> error </span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>( error )&#123;</span><br><span class="line">      <span class="built_in">console</span>.log( error )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ws.onclose = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">`xxx下线了`</span> )</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-低版本浏览器使用的-socket-io"><a href="#3-低版本浏览器使用的-socket-io" class="headerlink" title="3. 低版本浏览器使用的 socket.io"></a>3. 低版本浏览器使用的 socket.io</h4>
      </div>
        <div class="support-author">
          <p>感谢您的阅读。 🙏
          <a href="https://888.com/index.html" target="_blank"></a>
            <!--<a class="btn-pay"  href="#pay-modal">¥ 打赏支持</a>-->
          </p>
        </div>
        <!--
            <div class="like ">
              <div class="like-button">
                <a id="like-note" href="">
                  <i class="icon-heart"></i>喜欢
                </a>
              </div>
              <span id="likes-count">256</span>
            </div>
        -->
        <div class="otherLink">
          <div class="previous">
          </div>
          <div class="next">
          </div>
        </div>
        <div class="comments" id="comments">
          
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
  const gitalk = new Gitalk({
    clientID: '8888a8888',
    clientSecret: '8888886666666',
    repo: 'meijuna.github.io',
    owner: 'admin',
    admin: ['admin'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false
  })

  gitalk.render('comments');
</script>


        </div>
      </div>
    </div>
   
</main>
<div class="footer">
  <div class="info">
    <p>
    <a href="https://hexo.io"> Hexo </a> 强力驱动 |
      <a href="https://github.com/Youthink/hexo-themes-yearn"> Yearn </a>
      主题
    </p>
    <p>&copy;2013-2022 MeiJuna的博客 京ICP备103982号</p>
  </div>
</div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>//console
  var consoleConfig = '\n欢迎访问 https://meijuna.top ，围观MeiJuna的博客(づ｡◕‿‿◕｡)づ！\n,\n本博客使用 %cHexo%c 搭建，博客主题为 %chexo-themes-yearn%c ~~~ 🎉🎉🎉 \n\n源码 https://github.com/Youthink/hexo-themes-yearn 🚀\n\n如果喜欢可以 star 支持一下 ❤️~\n'.split(',');
  var canConsole = true;
  var consoleInfo = (function(consoleConfig) {
  if (!canConsole || !consoleConfig || consoleConfig.length < 1) {
    return;
  }
  var consoleColor = '#6190e8';
  var _console;
  var backgroundTextStyle = 'padding: 1px 5px;color: #fff;background: ' + consoleColor + ';'
  var textStyle = 'color: ' + consoleColor + ';';

  consoleConfig.map(o => {
    var num = (o.match(/%c/g) || []).length;
    if(/^http(s)?:\/\//.test(o)) {
      console.log('%c     ', 'background: url(' + o + ') no-repeat left center;font-size: 180px;');
      return;
    }
    if (num > 0) {
      var logArguments = [];
      for (var i = 0; i < num; i++) {
        if (i % 2 === 0) {
          logArguments.push(backgroundTextStyle);
        } else {
          logArguments.push(textStyle);
        }
      }
      (_console = console).log.apply(_console, ['%c' + o, textStyle].concat(logArguments));
      return;
    }
    console.log('%c' + o, textStyle);
  });
}(consoleConfig));</script><script type="text/javascript" src="/./js/main.js"></script>

  <script src="//at.alicdn.com/t/font_159214_mvtxvg9me9.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/koharu.model.json"},"display":{"position":"left","hOffset":56,"vOffset":-20,"bottom":"-20;","width":100,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
